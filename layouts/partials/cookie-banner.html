<!-- Cookie Banner Slide-Up Animation -->
<style>
    @keyframes slideUp {
        from {
            transform: translateY(100%);
            opacity: 0;
        }

        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    #pp-cookie-banner {
        animation: slideUp 0.5s ease-out forwards;
        background: #115e59;
    }

    #pp-cookie-banner.hiding {
        animation: slideDown 0.3s ease-in forwards;
    }

    @keyframes slideDown {
        from {
            transform: translateY(0);
            opacity: 1;
        }

        to {
            transform: translateY(100%);
            opacity: 0;
        }
    }

    #pp-cookie-accept {
        background-color: #14b8a6;
        transition: all 0.2s ease;
    }

    #pp-cookie-accept:hover {
        background-color: #2dd4bf;
        box-shadow: 0 10px 25px rgba(20, 184, 166, 0.5);
    }

    #pp-cookie-reject {
        border: 2px solid #94a3b8;
        background-color: transparent;
        transition: all 0.2s ease;
    }

    #pp-cookie-reject:hover {
        border-color: #ffffff;
        background-color: rgba(255, 255, 255, 0.1);
    }
</style>

<div id="pp-cookie-banner" role="dialog" aria-labelledby="pp-cookie-title" aria-modal="true"
    style="position: fixed; bottom: 0; left: 0; right: 0; z-index: 9999; display: none; box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.5); border-top: 1px solid rgba(20, 184, 166, 0.3);">
    <div class="container mx-auto px-4 py-3">
        <div class="max-w-7xl mx-auto"
            style="display: flex; flex-direction: column; align-items: flex-start; justify-content: space-between; gap: 1rem;">
            <style>
                @media (min-width: 768px) {
                    #pp-cookie-banner .max-w-7xl {
                        flex-direction: row !important;
                        align-items: center !important;
                    }
                }
            </style>
            <!-- Text Content with Cookie Icon -->
            <div class="flex-1 flex items-start gap-3">
                <span style="font-size: 2rem; flex-shrink: 0;" role="img" aria-label="Cookie">üç™</span>
                <div>
                    <p style="font-size: 1.125rem; font-weight: 500; color: #ffffff; margin-bottom: 0.25rem;">
                        We value your privacy
                    </p>
                    <p style="font-size: 0.95rem; color: #e2e8f0; line-height: 1.6;">
                        We use cookies to improve your experience and understand how our site is used.
                        <a href="/privacy/#cookies-and-web-beacons"
                            style="color: #5eead4; text-decoration: underline; text-underline-offset: 2px; font-weight: 500;">Learn
                            more</a>
                    </p>
                </div>
            </div>

            <!-- Buttons -->
            <div class="flex gap-3 flex-shrink-0" style="width: 100%;">
                <style>
                    @media (min-width: 768px) {
                        #pp-cookie-banner .flex.gap-3 {
                            width: auto !important;
                        }
                    }
                </style>
                <button id="pp-cookie-reject"
                    style="flex: 1; padding: 0.625rem 1.25rem; font-size: 0.95rem; color: #ffffff; font-weight: 500; border-radius: 0.5rem; white-space: nowrap; cursor: pointer;">
                    Decline
                </button>
                <button id="pp-cookie-accept"
                    style="flex: 1; padding: 0.625rem 1.25rem; font-size: 0.95rem; color: #ffffff; font-weight: 600; border-radius: 0.5rem; white-space: nowrap; cursor: pointer;">
                    Accept All
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    /**
     * Cookie Banner Controller
     * Waits for consent manager to be ready, then manages display
     */

    (function () {
        const CONSENT_STATES = {
            ACCEPTED: 'accepted',
            REJECTED: 'rejected'
        };

        let banner = null;
        let acceptBtn = null;
        let rejectBtn = null;

        // Wait for consent manager to be ready
        function waitForConsentManager(callback, attempts = 0) {
            if (window.ppConsentManagerReady && window.ppGetConsentState) {
                callback();
            } else if (attempts < 100) {
                setTimeout(() => waitForConsentManager(callback, attempts + 1), 50);
            } else {
                console.error('Cookie consent manager failed to load');
            }
        }

        // Initialize banner
        function initBanner() {
            banner = document.getElementById('pp-cookie-banner');
            acceptBtn = document.getElementById('pp-cookie-accept');
            rejectBtn = document.getElementById('pp-cookie-reject');

            if (!banner || !acceptBtn || !rejectBtn) {
                console.error('Cookie banner elements not found');
                return;
            }

            // Attach event listeners
            acceptBtn.addEventListener('click', handleAccept);
            rejectBtn.addEventListener('click', handleReject);

            // Listen for open banner event
            window.addEventListener('ppOpenBanner', showBanner);

            // Listen for consent changes (in case another tab changed it)
            window.addEventListener('storage', function (e) {
                if (e.key === 'pp_cookie_consent') {
                    updateBannerVisibility();
                }
            });

            // Keyboard support (Escape to dismiss - treats as reject)
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape' && banner && banner.style.display !== 'none') {
                    handleReject();
                }
            });

            // Check if we should show banner
            updateBannerVisibility();
        }

        // Show banner
        function showBanner() {
            if (banner) {
                banner.style.display = 'block';
                // Focus accept button for accessibility (without scrolling)
                setTimeout(() => {
                    if (acceptBtn) acceptBtn.focus({ preventScroll: true });
                }, 100);
            }
        }

        // Hide banner with animation
        function hideBanner() {
            if (banner) {
                banner.classList.add('hiding');
                setTimeout(() => {
                    banner.style.display = 'none';
                    banner.classList.remove('hiding');
                }, 300); // Match animation duration
            }
        }

        // Update banner visibility based on consent state
        function updateBannerVisibility() {
            const consentState = window.ppGetConsentState ? window.ppGetConsentState() : null;

            if (consentState === null) {
                // No consent stored, show banner
                showBanner();
            } else {
                // Consent exists (accepted or rejected), hide banner
                hideBanner();
            }
        }

        // Handle accept
        function handleAccept() {
            if (window.ppSetConsentAndLoad) {
                window.ppSetConsentAndLoad(CONSENT_STATES.ACCEPTED);
            }
            hideBanner();
        }

        // Handle reject
        function handleReject() {
            if (window.ppSetConsentAndLoad) {
                window.ppSetConsentAndLoad(CONSENT_STATES.REJECTED);
            }
            hideBanner();
        }

        // Wait for both DOM and consent manager to be ready
        function initialize() {
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function () {
                    waitForConsentManager(initBanner);
                });
            } else {
                waitForConsentManager(initBanner);
            }
        }

        // Start initialization
        initialize();
    })();
</script>