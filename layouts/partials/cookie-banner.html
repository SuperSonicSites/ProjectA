<div id="pp-cookie-banner" class="bg-slate-900 text-slate-300 shadow-2xl border-t border-slate-700" role="dialog" aria-labelledby="pp-cookie-title" aria-modal="true" style="position: fixed; bottom: 0; left: 0; right: 0; z-index: 9999; display: none;">
    <div class="container mx-auto px-4 py-6">
        <div class="max-w-4xl mx-auto flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <!-- Text Content -->
            <div class="flex-1">
                <h2 id="pp-cookie-title" class="text-lg font-bold text-white mb-2">Cookie Consent</h2>
                <p class="text-sm text-slate-400">
                    We use cookies for analytics (Google Analytics 4) and Pinterest measurement to understand how you use our site and improve your experience. You can accept all cookies or reject them.
                    <a href="/privacy/#cookies-and-web-beacons" class="text-teal-400 hover:text-teal-300 underline">Learn more</a>
                </p>
            </div>

            <!-- Buttons -->
            <div class="flex gap-3 flex-shrink-0">
                <button id="pp-cookie-reject" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white font-medium rounded-lg transition whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 focus:ring-offset-slate-900">
                    Reject
                </button>
                <button id="pp-cookie-accept" class="px-4 py-2 bg-teal-600 hover:bg-teal-700 text-white font-bold rounded-lg transition whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-teal-400 focus:ring-offset-2 focus:ring-offset-slate-900">
                    Accept All
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    /**
     * Cookie Banner Controller
     * Waits for consent manager to be ready, then manages display
     */
    
    (function() {
        const CONSENT_STATES = {
            ACCEPTED: 'accepted',
            REJECTED: 'rejected'
        };

        let banner = null;
        let acceptBtn = null;
        let rejectBtn = null;

        // Wait for consent manager to be ready
        function waitForConsentManager(callback, attempts = 0) {
            if (window.ppConsentManagerReady && window.ppGetConsentState) {
                callback();
            } else if (attempts < 100) {
                setTimeout(() => waitForConsentManager(callback, attempts + 1), 50);
            } else {
                console.error('Cookie consent manager failed to load');
            }
        }

        // Initialize banner
        function initBanner() {
            banner = document.getElementById('pp-cookie-banner');
            acceptBtn = document.getElementById('pp-cookie-accept');
            rejectBtn = document.getElementById('pp-cookie-reject');

            if (!banner || !acceptBtn || !rejectBtn) {
                console.error('Cookie banner elements not found');
                return;
            }

            // Attach event listeners
            acceptBtn.addEventListener('click', handleAccept);
            rejectBtn.addEventListener('click', handleReject);

            // Listen for open banner event
            window.addEventListener('ppOpenBanner', showBanner);

            // Listen for consent changes (in case another tab changed it)
            window.addEventListener('storage', function(e) {
                if (e.key === 'pp_cookie_consent') {
                    updateBannerVisibility();
                }
            });

            // Keyboard support (Escape to dismiss - treats as reject)
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && banner && banner.style.display !== 'none') {
                    handleReject();
                }
            });

            // Check if we should show banner
            updateBannerVisibility();
        }

        // Show banner
        function showBanner() {
            if (banner) {
                banner.style.display = 'block';
                // Focus accept button for accessibility (without scrolling)
                setTimeout(() => {
                    if (acceptBtn) acceptBtn.focus({ preventScroll: true });
                }, 100);
            }
        }

        // Hide banner
        function hideBanner() {
            if (banner) {
                banner.style.display = 'none';
            }
        }

        // Update banner visibility based on consent state
        function updateBannerVisibility() {
            const consentState = window.ppGetConsentState ? window.ppGetConsentState() : null;
            
            if (consentState === null) {
                // No consent stored, show banner
                showBanner();
            } else {
                // Consent exists (accepted or rejected), hide banner
                hideBanner();
            }
        }

        // Handle accept
        function handleAccept() {
            if (window.ppSetConsentAndLoad) {
                window.ppSetConsentAndLoad(CONSENT_STATES.ACCEPTED);
            }
            hideBanner();
        }

        // Handle reject
        function handleReject() {
            if (window.ppSetConsentAndLoad) {
                window.ppSetConsentAndLoad(CONSENT_STATES.REJECTED);
            }
            hideBanner();
        }

        // Wait for both DOM and consent manager to be ready
        function initialize() {
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    waitForConsentManager(initBanner);
                });
            } else {
                waitForConsentManager(initBanner);
            }
        }

        // Start initialization
        initialize();
    })();
</script>
